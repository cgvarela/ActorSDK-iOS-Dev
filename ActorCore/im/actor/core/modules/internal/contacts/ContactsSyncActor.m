//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/core/core-shared/src/main/java//im/actor/core/modules/internal/contacts/ContactsSyncActor.java
//

#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "im/actor/core/Configuration.h"
#include "im/actor/core/api/ApiUser.h"
#include "im/actor/core/api/rpc/RequestGetContacts.h"
#include "im/actor/core/api/rpc/ResponseGetContacts.h"
#include "im/actor/core/entity/Avatar.h"
#include "im/actor/core/entity/Contact.h"
#include "im/actor/core/entity/User.h"
#include "im/actor/core/modules/ModuleContext.h"
#include "im/actor/core/modules/Updates.h"
#include "im/actor/core/modules/internal/AppStateModule.h"
#include "im/actor/core/modules/internal/ContactsModule.h"
#include "im/actor/core/modules/internal/SearchModule.h"
#include "im/actor/core/modules/internal/contacts/ContactsSyncActor.h"
#include "im/actor/core/modules/updates/internal/ContactsLoaded.h"
#include "im/actor/core/modules/utils/ModuleActor.h"
#include "im/actor/core/network/RpcCallback.h"
#include "im/actor/core/network/RpcException.h"
#include "im/actor/core/viewmodel/UserVM.h"
#include "im/actor/core/viewmodel/generics/BooleanValueModel.h"
#include "im/actor/runtime/Crypto.h"
#include "im/actor/runtime/Log.h"
#include "im/actor/runtime/actors/Actor.h"
#include "im/actor/runtime/actors/ActorRef.h"
#include "im/actor/runtime/bser/DataInput.h"
#include "im/actor/runtime/bser/DataOutput.h"
#include "im/actor/runtime/storage/ListEngine.h"
#include "im/actor/runtime/storage/PreferencesStorage.h"
#include "java/io/IOException.h"
#include "java/io/UnsupportedEncodingException.h"
#include "java/lang/Boolean.h"
#include "java/lang/Integer.h"
#include "java/util/ArrayList.h"
#include "java/util/Arrays.h"
#include "java/util/Collections.h"
#include "java/util/Comparator.h"
#include "java/util/List.h"

#pragma clang diagnostic push
#pragma GCC diagnostic ignored "-Wdeprecated-declarations"

@interface ACContactsSyncActor () {
 @public
  jboolean ENABLE_LOG_;
  JavaUtilArrayList *contacts_;
  jboolean isInProgress_;
  jboolean isInvalidated_;
}

- (void)updateEngineList;

- (void)saveList;

- (void)notifyState;

@end

J2OBJC_FIELD_SETTER(ACContactsSyncActor, contacts_, JavaUtilArrayList *)

static NSString *ACContactsSyncActor_TAG_ = @"ContactsServerSync";
J2OBJC_STATIC_FIELD_GETTER(ACContactsSyncActor, TAG_, NSString *)

__attribute__((unused)) static void ACContactsSyncActor_updateEngineList(ACContactsSyncActor *self);

__attribute__((unused)) static void ACContactsSyncActor_saveList(ACContactsSyncActor *self);

__attribute__((unused)) static void ACContactsSyncActor_notifyState(ACContactsSyncActor *self);

@interface ACContactsSyncActor_PerformSync : NSObject

- (instancetype)init;

@end

J2OBJC_EMPTY_STATIC_INIT(ACContactsSyncActor_PerformSync)

__attribute__((unused)) static void ACContactsSyncActor_PerformSync_init(ACContactsSyncActor_PerformSync *self);

__attribute__((unused)) static ACContactsSyncActor_PerformSync *new_ACContactsSyncActor_PerformSync_init() NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(ACContactsSyncActor_PerformSync)

@interface ACContactsSyncActor_ContactsLoaded () {
 @public
  ARResponseGetContacts *result_;
}

@end

J2OBJC_FIELD_SETTER(ACContactsSyncActor_ContactsLoaded, result_, ARResponseGetContacts *)

@interface ACContactsSyncActor_ContactsAdded () {
 @public
  IOSIntArray *uids_;
}

@end

J2OBJC_FIELD_SETTER(ACContactsSyncActor_ContactsAdded, uids_, IOSIntArray *)

@interface ACContactsSyncActor_ContactsRemoved () {
 @public
  IOSIntArray *uids_;
}

@end

J2OBJC_FIELD_SETTER(ACContactsSyncActor_ContactsRemoved, uids_, IOSIntArray *)

@interface ACContactsSyncActor_UserChanged () {
 @public
  ACUser *user_;
}

@end

J2OBJC_FIELD_SETTER(ACContactsSyncActor_UserChanged, user_, ACUser *)

@interface ACContactsSyncActor_$1 : NSObject < ACRpcCallback > {
 @public
  ACContactsSyncActor *this$0_;
}

- (void)onResult:(ARResponseGetContacts *)response;

- (void)onError:(ACRpcException *)e;

- (instancetype)initWithACContactsSyncActor:(ACContactsSyncActor *)outer$;

@end

J2OBJC_EMPTY_STATIC_INIT(ACContactsSyncActor_$1)

J2OBJC_FIELD_SETTER(ACContactsSyncActor_$1, this$0_, ACContactsSyncActor *)

__attribute__((unused)) static void ACContactsSyncActor_$1_initWithACContactsSyncActor_(ACContactsSyncActor_$1 *self, ACContactsSyncActor *outer$);

__attribute__((unused)) static ACContactsSyncActor_$1 *new_ACContactsSyncActor_$1_initWithACContactsSyncActor_(ACContactsSyncActor *outer$) NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(ACContactsSyncActor_$1)

@interface ACContactsSyncActor_$2 : NSObject < JavaUtilComparator >

- (jint)compareWithId:(ACUser *)lhs
               withId:(ACUser *)rhs;

- (instancetype)init;

@end

J2OBJC_EMPTY_STATIC_INIT(ACContactsSyncActor_$2)

__attribute__((unused)) static void ACContactsSyncActor_$2_init(ACContactsSyncActor_$2 *self);

__attribute__((unused)) static ACContactsSyncActor_$2 *new_ACContactsSyncActor_$2_init() NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(ACContactsSyncActor_$2)

#line 0 "/Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/core/core-shared/src/main/java//im/actor/core/modules/internal/contacts/ContactsSyncActor.java"


#line 29
@implementation ACContactsSyncActor


#line 40
- (instancetype)initWithACModuleContext:(id<ACModuleContext>)context {
  ACContactsSyncActor_initWithACModuleContext_(self, context);
  return self;
}


#line 46
- (void)preStart {
  [super preStart];
  if (ENABLE_LOG_) {
    ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, @"Loading contacts ids from storage...");
  }
  IOSByteArray *data = [((id<ARPreferencesStorage>) nil_chk([self preferences])) getBytesWithKey:@"contact_list"];
  if (data != nil) {
    @try {
      ARDataInput *dataInput = new_ARDataInput_initWithByteArray_withInt_withInt_(data, 0, data->size_);
      jint count = [dataInput readInt];
      for (jint i = 0; i < count; i++) {
        [((JavaUtilArrayList *) nil_chk(contacts_)) addWithId:JavaLangInteger_valueOfWithInt_([dataInput readInt])];
      }
    }
    @catch (
#line 59
    JavaIoIOException *e) {
      [((JavaIoIOException *) nil_chk(e)) printStackTrace];
    }
  }
  ACContactsSyncActor_notifyState(self);
  [((ARActorRef *) nil_chk([self self__])) sendWithId:new_ACContactsSyncActor_PerformSync_init()];
}


#line 67
- (void)performSync {
  if (ENABLE_LOG_) {
    ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, @"Checking sync");
  }
  
#line 72
  if (isInProgress_) {
    if (ENABLE_LOG_) {
      ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, @"Sync in progress, invalidating current sync");
    }
    isInvalidated_ = true;
    return;
  }
  isInProgress_ = true;
  isInvalidated_ = false;
  
#line 82
  if (ENABLE_LOG_) {
    ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, @"Starting sync");
  }
  
#line 86
  IOSObjectArray *uids = [contacts_ toArrayWithNSObjectArray:[IOSObjectArray newArrayWithLength:[((JavaUtilArrayList *) nil_chk(contacts_)) size] type:JavaLangInteger_class_()]];
  JavaUtilArrays_sortWithNSObjectArray_(uids);
  NSString *hash_ = @"";
  {
    IOSObjectArray *a__ =
#line 89
    uids;
    JavaLangInteger * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    JavaLangInteger * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      jlong u = [((JavaLangInteger *) nil_chk(*b__++)) intValue];
      
#line 90
      if (((jint) [hash_ length]) != 0) {
        (void) JreStrAppendStrong(&hash_, "$", @",");
      }
      (void) JreStrAppendStrong(&hash_, "J", u);
    }
  }
  
#line 95
  IOSByteArray *hashData;
  @try {
    hashData = [hash_ getBytesWithCharsetName:@"UTF-8"];
  }
  @catch (
#line 98
  JavaIoUnsupportedEncodingException *e) {
    [((JavaIoUnsupportedEncodingException *) nil_chk(e)) printStackTrace];
    return;
  }
  NSString *hashValue = ARCrypto_hexWithByteArray_(ARCrypto_SHA256WithByteArray_(hashData));
  
#line 104
  ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, JreStrcat("$$", @"Performing sync with hash: ", hashValue));
  
#line 106
  [self requestWithACRequest:new_ARRequestGetContacts_initWithNSString_(hashValue) withACRpcCallback:new_ACContactsSyncActor_$1_initWithACContactsSyncActor_(self)];
}


#line 121
- (void)onContactsLoadedWithARResponseGetContacts:(ARResponseGetContacts *)result {
  if (ENABLE_LOG_) {
    ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, @"Sync result received");
  }
  
#line 126
  isInProgress_ = false;
  
#line 128
  [((ACAppStateModule *) nil_chk([((id<ACModuleContext>) nil_chk([self context])) getAppStateModule])) onContactsLoaded];
  
#line 130
  if ([((ARResponseGetContacts *) nil_chk(result)) isNotChanged]) {
    ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, @"Sync: Not changed");
    if (isInvalidated_) {
      [self performSync];
    }
    else {
    }
    return;
  }
  
#line 140
  if (ENABLE_LOG_) {
    ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, JreStrcat("$I$", @"Sync received ", [((id<JavaUtilList>) nil_chk([result getUsers])) size], @" contacts"));
  }
  {
    IOSObjectArray *a__ =
#line 145
    [contacts_ toArrayWithNSObjectArray:[IOSObjectArray newArrayWithLength:[((JavaUtilArrayList *) nil_chk(contacts_)) size] type:JavaLangInteger_class_()]];
    JavaLangInteger * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    JavaLangInteger * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      JavaLangInteger *uid = *b__++;
      {
        
#line 146
        for (ARApiUser * __strong u in nil_chk([result getUsers])) {
          if ([((ARApiUser *) nil_chk(u)) getId] == [((JavaLangInteger *) nil_chk(uid)) intValue]) {
            goto continue_outer;
          }
        }
        if (ENABLE_LOG_) {
          ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, JreStrcat("$@", @"Removing: #", uid));
        }
        [contacts_ removeWithId:uid];
        if ([self getUserWithInt:[((JavaLangInteger *) nil_chk(uid)) intValue]] != nil) {
          [((ACBooleanValueModel *) nil_chk([((ACUserVM *) nil_chk([self getUserVMWithInt:[uid intValue]])) isContactModel])) changeWithValue:JavaLangBoolean_valueOfWithBoolean_(false)];
        }
        [((ACContactsModule *) nil_chk([((id<ACModuleContext>) nil_chk([self context])) getContactsModule])) markNonContactWithInt:[uid intValue]];
      }
      continue_outer: ;
    }
  }
  
#line 160
  for (ARApiUser * __strong u in nil_chk([result getUsers])) {
    if ([contacts_ containsWithId:JavaLangInteger_valueOfWithInt_([((ARApiUser *) nil_chk(u)) getId])]) {
      continue;
    }
    if (ENABLE_LOG_) {
      ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, JreStrcat("$I", @"Adding: #", [u getId]));
    }
    [contacts_ addWithId:JavaLangInteger_valueOfWithInt_([u getId])];
    if ([self getUserWithInt:[u getId]] != nil) {
      [((ACBooleanValueModel *) nil_chk([((ACUserVM *) nil_chk([self getUserVMWithInt:[u getId]])) isContactModel])) changeWithValue:JavaLangBoolean_valueOfWithBoolean_(true)];
    }
    [((ACContactsModule *) nil_chk([((id<ACModuleContext>) nil_chk([self context])) getContactsModule])) markContactWithInt:[u getId]];
  }
  ACContactsSyncActor_saveList(self);
  
#line 175
  ACContactsSyncActor_updateEngineList(self);
  
#line 177
  if (isInvalidated_) {
    [((ARActorRef *) nil_chk([self self__])) sendWithId:new_ACContactsSyncActor_PerformSync_init()];
  }
}


#line 182
- (void)onContactsAddedWithIntArray:(IOSIntArray *)uids {
  if (ENABLE_LOG_) {
    ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, @"OnContactsAdded received");
  }
  {
    IOSIntArray *a__ = uids;
    jint const *b__ = ((IOSIntArray *) nil_chk(a__))->buffer_;
    jint const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      jint uid = *b__++;
      
#line 188
      if (ENABLE_LOG_) {
        ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, JreStrcat("$I", @"Adding: #", uid));
      }
      [((JavaUtilArrayList *) nil_chk(contacts_)) addWithId:JavaLangInteger_valueOfWithInt_(uid)];
      [((ACContactsModule *) nil_chk([((id<ACModuleContext>) nil_chk([self context])) getContactsModule])) markContactWithInt:uid];
      [((ACBooleanValueModel *) nil_chk([((ACUserVM *) nil_chk([self getUserVMWithInt:uid])) isContactModel])) changeWithValue:JavaLangBoolean_valueOfWithBoolean_(true)];
    }
  }
  
#line 195
  ACContactsSyncActor_saveList(self);
  
#line 197
  ACContactsSyncActor_updateEngineList(self);
  
#line 199
  [((ARActorRef *) nil_chk([self self__])) sendWithId:new_ACContactsSyncActor_PerformSync_init()];
}


#line 202
- (void)onContactsRemovedWithIntArray:(IOSIntArray *)uids {
  if (ENABLE_LOG_) {
    ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, @"OnContactsRemoved received");
  }
  {
    IOSIntArray *a__ = uids;
    jint const *b__ = ((IOSIntArray *) nil_chk(a__))->buffer_;
    jint const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      jint uid = *b__++;
      
#line 208
      ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, JreStrcat("$I", @"Removing: #", uid));
      [((JavaUtilArrayList *) nil_chk(contacts_)) removeWithId:JavaLangInteger_valueOfWithInt_(uid)];
      [((ACContactsModule *) nil_chk([((id<ACModuleContext>) nil_chk([self context])) getContactsModule])) markNonContactWithInt:uid];
      [((ACBooleanValueModel *) nil_chk([((ACUserVM *) nil_chk([self getUserVMWithInt:uid])) isContactModel])) changeWithValue:JavaLangBoolean_valueOfWithBoolean_(false)];
    }
  }
  
#line 213
  ACContactsSyncActor_saveList(self);
  
#line 215
  ACContactsSyncActor_updateEngineList(self);
  
#line 217
  [((ARActorRef *) nil_chk([self self__])) sendWithId:new_ACContactsSyncActor_PerformSync_init()];
}


#line 220
- (void)onUserChangedWithACUser:(ACUser *)user {
  if (ENABLE_LOG_) {
    ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, JreStrcat("$I$", @"OnUserChanged #", [((ACUser *) nil_chk(user)) getUid], @" received"));
  }
  
#line 225
  if (![((JavaUtilArrayList *) nil_chk(contacts_)) containsWithId:JavaLangInteger_valueOfWithInt_([((ACUser *) nil_chk(user)) getUid])]) {
    return;
  }
  
#line 229
  ACContactsSyncActor_updateEngineList(self);
}


#line 232
- (void)updateEngineList {
  ACContactsSyncActor_updateEngineList(self);
}


#line 267
- (void)saveList {
  ACContactsSyncActor_saveList(self);
}


#line 279
- (void)notifyState {
  ACContactsSyncActor_notifyState(self);
}


#line 284
- (void)onReceiveWithId:(id)message {
  if ([message isKindOfClass:[ACContactsSyncActor_ContactsLoaded class]]) {
    [self onContactsLoadedWithARResponseGetContacts:[((ACContactsSyncActor_ContactsLoaded *) nil_chk(((ACContactsSyncActor_ContactsLoaded *) check_class_cast(message, [ACContactsSyncActor_ContactsLoaded class])))) getResult]];
  }
  else
#line 287
  if ([message isKindOfClass:[ACContactsSyncActor_ContactsAdded class]]) {
    [self onContactsAddedWithIntArray:[((ACContactsSyncActor_ContactsAdded *) nil_chk(((ACContactsSyncActor_ContactsAdded *) check_class_cast(message, [ACContactsSyncActor_ContactsAdded class])))) getUids]];
  }
  else
#line 289
  if ([message isKindOfClass:[ACContactsSyncActor_ContactsRemoved class]]) {
    [self onContactsRemovedWithIntArray:[((ACContactsSyncActor_ContactsRemoved *) nil_chk(((ACContactsSyncActor_ContactsRemoved *) check_class_cast(message, [ACContactsSyncActor_ContactsRemoved class])))) getUids]];
  }
  else
#line 291
  if ([message isKindOfClass:[ACContactsSyncActor_UserChanged class]]) {
    [self onUserChangedWithACUser:[((ACContactsSyncActor_UserChanged *) nil_chk(((ACContactsSyncActor_UserChanged *) check_class_cast(message, [ACContactsSyncActor_UserChanged class])))) getUser]];
  }
  else
#line 293
  if ([message isKindOfClass:[ACContactsSyncActor_PerformSync class]]) {
    [self performSync];
  }
  else {
    
#line 296
    [self dropWithId:message];
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithACModuleContext:", "ContactsSyncActor", NULL, 0x1, NULL, NULL },
    { "preStart", NULL, "V", 0x1, NULL, NULL },
    { "performSync", NULL, "V", 0x1, NULL, NULL },
    { "onContactsLoadedWithARResponseGetContacts:", "onContactsLoaded", "V", 0x1, NULL, NULL },
    { "onContactsAddedWithIntArray:", "onContactsAdded", "V", 0x1, NULL, NULL },
    { "onContactsRemovedWithIntArray:", "onContactsRemoved", "V", 0x1, NULL, NULL },
    { "onUserChangedWithACUser:", "onUserChanged", "V", 0x1, NULL, NULL },
    { "updateEngineList", NULL, "V", 0x2, NULL, NULL },
    { "saveList", NULL, "V", 0x2, NULL, NULL },
    { "notifyState", NULL, "V", 0x2, NULL, NULL },
    { "onReceiveWithId:", "onReceive", "V", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "TAG_", NULL, 0x1a, "Ljava.lang.String;", &ACContactsSyncActor_TAG_, NULL, .constantValue.asLong = 0 },
    { "ENABLE_LOG_", NULL, 0x12, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "contacts_", NULL, 0x2, "Ljava.util.ArrayList;", NULL, "Ljava/util/ArrayList<Ljava/lang/Integer;>;", .constantValue.asLong = 0 },
    { "isInProgress_", NULL, 0x2, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "isInvalidated_", NULL, 0x2, "Z", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const char *inner_classes[] = {"Lim.actor.core.modules.internal.contacts.ContactsSyncActor$PerformSync;", "Lim.actor.core.modules.internal.contacts.ContactsSyncActor$ContactsLoaded;", "Lim.actor.core.modules.internal.contacts.ContactsSyncActor$ContactsAdded;", "Lim.actor.core.modules.internal.contacts.ContactsSyncActor$ContactsRemoved;", "Lim.actor.core.modules.internal.contacts.ContactsSyncActor$UserChanged;"};
  static const J2ObjcClassInfo _ACContactsSyncActor = { 2, "ContactsSyncActor", "im.actor.core.modules.internal.contacts", NULL, 0x1, 11, methods, 5, fields, 0, NULL, 5, inner_classes, NULL, NULL };
  return &_ACContactsSyncActor;
}

@end


#line 40
void ACContactsSyncActor_initWithACModuleContext_(ACContactsSyncActor *self, id<ACModuleContext> context) {
  (void) ACModuleActor_initWithACModuleContext_(self, context);
  self->contacts_ = new_JavaUtilArrayList_init();
  self->isInProgress_ =
#line 37
  false;
  self->isInvalidated_ = false;
  
#line 42
  self->ENABLE_LOG_ = [((ACConfiguration *) nil_chk([((id<ACModuleContext>) nil_chk(context)) getConfiguration])) isEnableContactsLogging];
}


#line 40
ACContactsSyncActor *new_ACContactsSyncActor_initWithACModuleContext_(id<ACModuleContext> context) {
  ACContactsSyncActor *self = [ACContactsSyncActor alloc];
  ACContactsSyncActor_initWithACModuleContext_(self, context);
  return self;
}


#line 232
void ACContactsSyncActor_updateEngineList(ACContactsSyncActor *self) {
  if (self->ENABLE_LOG_) {
    ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, @"Saving contact EngineList");
  }
  JavaUtilArrayList *userList = new_JavaUtilArrayList_init();
  for (JavaLangInteger *boxed__ in nil_chk(self->contacts_)) {
    jint u = [((JavaLangInteger *) nil_chk(boxed__)) intValue];
    
#line 238
    [userList addWithId:[self getUserWithInt:u]];
  }
  JavaUtilCollections_sortWithJavaUtilList_withJavaUtilComparator_(userList, new_ACContactsSyncActor_$2_init());
  
#line 247
  id<JavaUtilList> registeredContacts = new_JavaUtilArrayList_init();
  jint index = -1;
  for (ACUser * __strong userModel in userList) {
    ACContact *contact = new_ACContact_initWithInt_withLong_withACAvatar_withNSString_([((ACUser *) nil_chk(userModel)) getUid],
#line 251
    (jlong) index--,
#line 252
    [userModel getAvatar],
#line 253
    [userModel getName]);
    [registeredContacts addWithId:contact];
  }
  [((id<ARListEngine>) nil_chk([((ACContactsModule *) nil_chk([((id<ACModuleContext>) nil_chk([self context])) getContactsModule])) getContacts])) replaceItems:registeredContacts];
  IOSObjectArray *sorted = [IOSObjectArray newArrayWithLength:[self->contacts_ size] type:JavaLangInteger_class_()];
  jint sindex = 0;
  for (ACUser * __strong userModel in userList) {
    (void) IOSObjectArray_Set(sorted, sindex++, JavaLangInteger_valueOfWithInt_([((ACUser *) nil_chk(userModel)) getUid]));
  }
  [((ACSearchModule *) nil_chk([((id<ACModuleContext>) nil_chk([self context])) getSearchModule])) onContactsChangedWithJavaLangIntegerArray:sorted];
  
#line 264
  ACContactsSyncActor_notifyState(self);
}


#line 267
void ACContactsSyncActor_saveList(ACContactsSyncActor *self) {
  if (self->ENABLE_LOG_) {
    ARLog_dWithNSString_withNSString_(ACContactsSyncActor_TAG_, @"Saving contacts ids to storage");
  }
  ARDataOutput *dataOutput = new_ARDataOutput_init();
  [dataOutput writeIntWithInt:[((JavaUtilArrayList *) nil_chk(self->contacts_)) size]];
  for (JavaLangInteger *boxed__ in self->contacts_) {
    jint l = [((JavaLangInteger *) nil_chk(boxed__)) intValue];
    
#line 274
    [dataOutput writeIntWithInt:l];
  }
  [((id<ARPreferencesStorage>) nil_chk([self preferences])) putBytesWithKey:@"contact_list" withValue:[dataOutput toByteArray]];
}


#line 279
void ACContactsSyncActor_notifyState(ACContactsSyncActor *self) {
  [((ACAppStateModule *) nil_chk([((id<ACModuleContext>) nil_chk([self context])) getAppStateModule])) onContactsUpdateWithBoolean:[((id<ARListEngine>) nil_chk([((ACContactsModule *) nil_chk([((id<ACModuleContext>) nil_chk([self context])) getContactsModule])) getContacts])) isEmpty]];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ACContactsSyncActor)

#line 0 "/Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/core/core-shared/src/main/java//im/actor/core/modules/internal/contacts/ContactsSyncActor.java"


#line 300
@implementation ACContactsSyncActor_PerformSync

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  ACContactsSyncActor_PerformSync_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "init", NULL, NULL, 0x2, NULL, NULL },
  };
  static const J2ObjcClassInfo _ACContactsSyncActor_PerformSync = { 2, "PerformSync", "im.actor.core.modules.internal.contacts", "ContactsSyncActor", 0xa, 1, methods, 0, NULL, 0, NULL, 0, NULL, NULL, NULL };
  return &_ACContactsSyncActor_PerformSync;
}

@end

void ACContactsSyncActor_PerformSync_init(ACContactsSyncActor_PerformSync *self) {
  (void) NSObject_init(self);
}

ACContactsSyncActor_PerformSync *new_ACContactsSyncActor_PerformSync_init() {
  ACContactsSyncActor_PerformSync *self = [ACContactsSyncActor_PerformSync alloc];
  ACContactsSyncActor_PerformSync_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ACContactsSyncActor_PerformSync)

#line 0 "/Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/core/core-shared/src/main/java//im/actor/core/modules/internal/contacts/ContactsSyncActor.java"


#line 304
@implementation ACContactsSyncActor_ContactsLoaded


#line 307
- (instancetype)initWithARResponseGetContacts:(ARResponseGetContacts *)result {
  ACContactsSyncActor_ContactsLoaded_initWithARResponseGetContacts_(self, result);
  return self;
}


#line 311
- (ARResponseGetContacts *)getResult {
  return result_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithARResponseGetContacts:", "ContactsLoaded", NULL, 0x1, NULL, NULL },
    { "getResult", NULL, "Lim.actor.core.api.rpc.ResponseGetContacts;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "result_", NULL, 0x2, "Lim.actor.core.api.rpc.ResponseGetContacts;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _ACContactsSyncActor_ContactsLoaded = { 2, "ContactsLoaded", "im.actor.core.modules.internal.contacts", "ContactsSyncActor", 0x9, 2, methods, 1, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ACContactsSyncActor_ContactsLoaded;
}

@end


#line 307
void ACContactsSyncActor_ContactsLoaded_initWithARResponseGetContacts_(ACContactsSyncActor_ContactsLoaded *self, ARResponseGetContacts *result) {
  (void) NSObject_init(self);
  
#line 308
  self->result_ = result;
}


#line 307
ACContactsSyncActor_ContactsLoaded *new_ACContactsSyncActor_ContactsLoaded_initWithARResponseGetContacts_(ARResponseGetContacts *result) {
  ACContactsSyncActor_ContactsLoaded *self = [ACContactsSyncActor_ContactsLoaded alloc];
  ACContactsSyncActor_ContactsLoaded_initWithARResponseGetContacts_(self, result);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ACContactsSyncActor_ContactsLoaded)

#line 0 "/Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/core/core-shared/src/main/java//im/actor/core/modules/internal/contacts/ContactsSyncActor.java"


#line 316
@implementation ACContactsSyncActor_ContactsAdded


#line 319
- (instancetype)initWithIntArray:(IOSIntArray *)uids {
  ACContactsSyncActor_ContactsAdded_initWithIntArray_(self, uids);
  return self;
}


#line 323
- (IOSIntArray *)getUids {
  return uids_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithIntArray:", "ContactsAdded", NULL, 0x1, NULL, NULL },
    { "getUids", NULL, "[I", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "uids_", NULL, 0x2, "[I", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _ACContactsSyncActor_ContactsAdded = { 2, "ContactsAdded", "im.actor.core.modules.internal.contacts", "ContactsSyncActor", 0x9, 2, methods, 1, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ACContactsSyncActor_ContactsAdded;
}

@end


#line 319
void ACContactsSyncActor_ContactsAdded_initWithIntArray_(ACContactsSyncActor_ContactsAdded *self, IOSIntArray *uids) {
  (void) NSObject_init(self);
  
#line 320
  self->uids_ = uids;
}


#line 319
ACContactsSyncActor_ContactsAdded *new_ACContactsSyncActor_ContactsAdded_initWithIntArray_(IOSIntArray *uids) {
  ACContactsSyncActor_ContactsAdded *self = [ACContactsSyncActor_ContactsAdded alloc];
  ACContactsSyncActor_ContactsAdded_initWithIntArray_(self, uids);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ACContactsSyncActor_ContactsAdded)

#line 0 "/Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/core/core-shared/src/main/java//im/actor/core/modules/internal/contacts/ContactsSyncActor.java"


#line 328
@implementation ACContactsSyncActor_ContactsRemoved


#line 331
- (instancetype)initWithIntArray:(IOSIntArray *)uids {
  ACContactsSyncActor_ContactsRemoved_initWithIntArray_(self, uids);
  return self;
}


#line 335
- (IOSIntArray *)getUids {
  return uids_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithIntArray:", "ContactsRemoved", NULL, 0x1, NULL, NULL },
    { "getUids", NULL, "[I", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "uids_", NULL, 0x2, "[I", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _ACContactsSyncActor_ContactsRemoved = { 2, "ContactsRemoved", "im.actor.core.modules.internal.contacts", "ContactsSyncActor", 0x9, 2, methods, 1, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ACContactsSyncActor_ContactsRemoved;
}

@end


#line 331
void ACContactsSyncActor_ContactsRemoved_initWithIntArray_(ACContactsSyncActor_ContactsRemoved *self, IOSIntArray *uids) {
  (void) NSObject_init(self);
  
#line 332
  self->uids_ = uids;
}


#line 331
ACContactsSyncActor_ContactsRemoved *new_ACContactsSyncActor_ContactsRemoved_initWithIntArray_(IOSIntArray *uids) {
  ACContactsSyncActor_ContactsRemoved *self = [ACContactsSyncActor_ContactsRemoved alloc];
  ACContactsSyncActor_ContactsRemoved_initWithIntArray_(self, uids);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ACContactsSyncActor_ContactsRemoved)

#line 0 "/Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/core/core-shared/src/main/java//im/actor/core/modules/internal/contacts/ContactsSyncActor.java"


#line 340
@implementation ACContactsSyncActor_UserChanged


#line 343
- (instancetype)initWithACUser:(ACUser *)user {
  ACContactsSyncActor_UserChanged_initWithACUser_(self, user);
  return self;
}


#line 347
- (ACUser *)getUser {
  return user_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithACUser:", "UserChanged", NULL, 0x1, NULL, NULL },
    { "getUser", NULL, "Lim.actor.core.entity.User;", 0x1, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "user_", NULL, 0x2, "Lim.actor.core.entity.User;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _ACContactsSyncActor_UserChanged = { 2, "UserChanged", "im.actor.core.modules.internal.contacts", "ContactsSyncActor", 0x9, 2, methods, 1, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ACContactsSyncActor_UserChanged;
}

@end


#line 343
void ACContactsSyncActor_UserChanged_initWithACUser_(ACContactsSyncActor_UserChanged *self, ACUser *user) {
  (void) NSObject_init(self);
  
#line 344
  self->user_ = user;
}


#line 343
ACContactsSyncActor_UserChanged *new_ACContactsSyncActor_UserChanged_initWithACUser_(ACUser *user) {
  ACContactsSyncActor_UserChanged *self = [ACContactsSyncActor_UserChanged alloc];
  ACContactsSyncActor_UserChanged_initWithACUser_(self, user);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ACContactsSyncActor_UserChanged)

#line 0 "/Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/core/core-shared/src/main/java//im/actor/core/modules/internal/contacts/ContactsSyncActor.java"

@implementation ACContactsSyncActor_$1


#line 108
- (void)onResult:(ARResponseGetContacts *)response {
  [((ACUpdates *) nil_chk([this$0_ updates])) onUpdateReceivedWithId:new_ACContactsLoaded_initWithARResponseGetContacts_(
#line 110
  response)];
}

- (void)onError:(ACRpcException *)e {
  this$0_->isInProgress_ = false;
  [((ACRpcException *) nil_chk(e)) printStackTrace];
}

- (instancetype)initWithACContactsSyncActor:(ACContactsSyncActor *)outer$ {
  ACContactsSyncActor_$1_initWithACContactsSyncActor_(self, outer$);
  return self;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "onResult:", "onResult", "V", 0x1, NULL, NULL },
    { "onError:", "onError", "V", 0x1, NULL, NULL },
    { "initWithACContactsSyncActor:", "", NULL, 0x0, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lim.actor.core.modules.internal.contacts.ContactsSyncActor;", NULL, NULL, .constantValue.asLong = 0 },
  };
  static const J2ObjCEnclosingMethodInfo enclosing_method = { "ACContactsSyncActor", "performSync" };
  static const J2ObjcClassInfo _ACContactsSyncActor_$1 = { 2, "", "im.actor.core.modules.internal.contacts", "ContactsSyncActor", 0x8008, 3, methods, 1, fields, 0, NULL, 0, NULL, &enclosing_method, "Ljava/lang/Object;Lim/actor/core/network/RpcCallback<Lim/actor/core/api/rpc/ResponseGetContacts;>;" };
  return &_ACContactsSyncActor_$1;
}

@end

void ACContactsSyncActor_$1_initWithACContactsSyncActor_(ACContactsSyncActor_$1 *self, ACContactsSyncActor *outer$) {
  self->this$0_ = outer$;
  (void) NSObject_init(self);
}

ACContactsSyncActor_$1 *new_ACContactsSyncActor_$1_initWithACContactsSyncActor_(ACContactsSyncActor *outer$) {
  ACContactsSyncActor_$1 *self = [ACContactsSyncActor_$1 alloc];
  ACContactsSyncActor_$1_initWithACContactsSyncActor_(self, outer$);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ACContactsSyncActor_$1)

#line 0 "/Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/core/core-shared/src/main/java//im/actor/core/modules/internal/contacts/ContactsSyncActor.java"

@implementation ACContactsSyncActor_$2


#line 242
- (jint)compareWithId:(ACUser *)lhs
               withId:(ACUser *)rhs {
  return [((NSString *) nil_chk([((ACUser *) nil_chk(lhs)) getName])) compareToWithId:[((ACUser *) nil_chk(rhs)) getName]];
}

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  ACContactsSyncActor_$2_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "compareWithId:withId:", "compare", "I", 0x1, NULL, NULL },
    { "init", "", NULL, 0x0, NULL, NULL },
  };
  static const J2ObjCEnclosingMethodInfo enclosing_method = { "ACContactsSyncActor", "updateEngineList" };
  static const J2ObjcClassInfo _ACContactsSyncActor_$2 = { 2, "", "im.actor.core.modules.internal.contacts", "ContactsSyncActor", 0x8008, 2, methods, 0, NULL, 0, NULL, 0, NULL, &enclosing_method, "Ljava/lang/Object;Ljava/util/Comparator<Lim/actor/core/entity/User;>;" };
  return &_ACContactsSyncActor_$2;
}

@end

void ACContactsSyncActor_$2_init(ACContactsSyncActor_$2 *self) {
  (void) NSObject_init(self);
}

ACContactsSyncActor_$2 *new_ACContactsSyncActor_$2_init() {
  ACContactsSyncActor_$2 *self = [ACContactsSyncActor_$2 alloc];
  ACContactsSyncActor_$2_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ACContactsSyncActor_$2)

#pragma clang diagnostic pop
