//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/runtime/runtime-shared/src/main/java//im/actor/runtime/storage/SyncKeyValue.java
//

#include "IOSClass.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "im/actor/runtime/storage/KeyValueStorage.h"
#include "im/actor/runtime/storage/SyncKeyValue.h"
#include "java/lang/Long.h"
#include "java/util/HashMap.h"

#pragma clang diagnostic push
#pragma GCC diagnostic ignored "-Wdeprecated-declarations"

@interface ARSyncKeyValue () {
 @public
  id<ARKeyValueStorage> storage_;
  JavaUtilHashMap *cached_;
}

@end

J2OBJC_FIELD_SETTER(ARSyncKeyValue, storage_, id<ARKeyValueStorage>)
J2OBJC_FIELD_SETTER(ARSyncKeyValue, cached_, JavaUtilHashMap *)

#line 0 "/Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/runtime/runtime-shared/src/main/java//im/actor/runtime/storage/SyncKeyValue.java"


#line 9
@implementation ARSyncKeyValue


#line 15
- (instancetype)initWithARKeyValueStorage:(id<ARKeyValueStorage>)storage {
  ARSyncKeyValue_initWithARKeyValueStorage_(self, storage);
  return self;
}


#line 19
- (void)putWithLong:(jlong)key
      withByteArray:(IOSByteArray *)data {
  @synchronized(self) {
    
#line 20
    [((id<ARKeyValueStorage>) nil_chk(storage_)) addOrUpdateItemWithKey:key withData:data];
    (void) [((JavaUtilHashMap *) nil_chk(cached_)) putWithId:JavaLangLong_valueOfWithLong_(key) withId:data];
  }
}


#line 24
- (void)delete__WithLong:(jlong)key {
  @synchronized(self) {
    
#line 25
    [((id<ARKeyValueStorage>) nil_chk(storage_)) removeItemWithKey:key];
    (void) [((JavaUtilHashMap *) nil_chk(cached_)) putWithId:JavaLangLong_valueOfWithLong_(key) withId:nil];
  }
}


#line 29
- (IOSByteArray *)getWithLong:(jlong)key {
  @synchronized(self) {
    
#line 30
    if ([((JavaUtilHashMap *) nil_chk(cached_)) containsKeyWithId:JavaLangLong_valueOfWithLong_(key)]) {
      return [cached_ getWithId:JavaLangLong_valueOfWithLong_(key)];
    }
    return [((id<ARKeyValueStorage>) nil_chk(storage_)) loadItemWithKey:key];
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithARKeyValueStorage:", "SyncKeyValue", NULL, 0x1, NULL, NULL },
    { "putWithLong:withByteArray:", "put", "V", 0x21, NULL, NULL },
    { "delete__WithLong:", "delete", "V", 0x21, NULL, NULL },
    { "getWithLong:", "get", "[B", 0x21, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "storage_", NULL, 0x2, "Lim.actor.runtime.storage.KeyValueStorage;", NULL, NULL, .constantValue.asLong = 0 },
    { "cached_", NULL, 0x2, "Ljava.util.HashMap;", NULL, "Ljava/util/HashMap<Ljava/lang/Long;L[B;>;", .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _ARSyncKeyValue = { 2, "SyncKeyValue", "im.actor.runtime.storage", NULL, 0x1, 4, methods, 2, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ARSyncKeyValue;
}

@end


#line 15
void ARSyncKeyValue_initWithARKeyValueStorage_(ARSyncKeyValue *self, id<ARKeyValueStorage> storage) {
  (void) NSObject_init(self);
  self->cached_ = new_JavaUtilHashMap_init();
  
#line 16
  self->storage_ = storage;
}


#line 15
ARSyncKeyValue *new_ARSyncKeyValue_initWithARKeyValueStorage_(id<ARKeyValueStorage> storage) {
  ARSyncKeyValue *self = [ARSyncKeyValue alloc];
  ARSyncKeyValue_initWithARKeyValueStorage_(self, storage);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ARSyncKeyValue)

#pragma clang diagnostic pop
