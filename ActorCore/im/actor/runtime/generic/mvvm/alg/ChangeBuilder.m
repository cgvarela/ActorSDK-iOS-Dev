//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/runtime/runtime-generic/src/main/java//im/actor/runtime/generic/mvvm/alg/ChangeBuilder.java
//

#include "J2ObjC_source.h"
#include "im/actor/runtime/generic/mvvm/AppleListUpdate.h"
#include "im/actor/runtime/generic/mvvm/ChangeDescription.h"
#include "im/actor/runtime/generic/mvvm/alg/ChangeBuilder.h"
#include "im/actor/runtime/generic/mvvm/alg/Move.h"
#include "java/lang/Integer.h"
#include "java/util/ArrayList.h"

#pragma clang diagnostic push
#pragma GCC diagnostic ignored "-Wdeprecated-declarations"

@interface ARChangeBuilder ()

+ (JavaUtilArrayList *)optimizeWithJavaUtilArrayList:(JavaUtilArrayList *)modifications;

- (instancetype)init;

@end

__attribute__((unused)) static JavaUtilArrayList *ARChangeBuilder_optimizeWithJavaUtilArrayList_(JavaUtilArrayList *modifications);

__attribute__((unused)) static void ARChangeBuilder_init(ARChangeBuilder *self);

__attribute__((unused)) static ARChangeBuilder *new_ARChangeBuilder_init() NS_RETURNS_RETAINED;

@interface ARChangeBuilder_State : NSObject {
 @public
  jboolean wasDeleted_;
  jint startingIndex_;
  jboolean wasUpdated_;
  jboolean wasMoved_;
  jboolean wasAdded_;
  id item_;
}

- (instancetype)init;

@end

J2OBJC_EMPTY_STATIC_INIT(ARChangeBuilder_State)

J2OBJC_FIELD_SETTER(ARChangeBuilder_State, item_, id)

__attribute__((unused)) static void ARChangeBuilder_State_init(ARChangeBuilder_State *self);

__attribute__((unused)) static ARChangeBuilder_State *new_ARChangeBuilder_State_init() NS_RETURNS_RETAINED;

J2OBJC_TYPE_LITERAL_HEADER(ARChangeBuilder_State)

#line 0 "/Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/runtime/runtime-generic/src/main/java//im/actor/runtime/generic/mvvm/alg/ChangeBuilder.java"


#line 12
@implementation ARChangeBuilder

+ (JavaUtilArrayList *)optimizeWithJavaUtilArrayList:(JavaUtilArrayList *)modifications {
  return ARChangeBuilder_optimizeWithJavaUtilArrayList_(modifications);
}


#line 51
+ (JavaUtilArrayList *)processAndroidModificationsWithJavaUtilArrayList:(JavaUtilArrayList *)modifications
                                                  withJavaUtilArrayList:(JavaUtilArrayList *)initialList {
  return ARChangeBuilder_processAndroidModificationsWithJavaUtilArrayList_withJavaUtilArrayList_(modifications, initialList);
}


#line 58
+ (ARAppleListUpdate *)processAppleModificationsWithJavaUtilArrayList:(JavaUtilArrayList *)modifications
                                                withJavaUtilArrayList:(JavaUtilArrayList *)initialList
                                                          withBoolean:(jboolean)isLoadMore {
  return ARChangeBuilder_processAppleModificationsWithJavaUtilArrayList_withJavaUtilArrayList_withBoolean_(modifications, initialList, isLoadMore);
}

J2OBJC_IGNORE_DESIGNATED_BEGIN

#line 134
- (instancetype)init {
  ARChangeBuilder_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "optimizeWithJavaUtilArrayList:", "optimize", "Ljava.util.ArrayList;", 0xa, NULL, "<T:Ljava/lang/Object;>(Ljava/util/ArrayList<Lim/actor/runtime/generic/mvvm/ChangeDescription<TT;>;>;)Ljava/util/ArrayList<Lim/actor/runtime/generic/mvvm/ChangeDescription<TT;>;>;" },
    { "processAndroidModificationsWithJavaUtilArrayList:withJavaUtilArrayList:", "processAndroidModifications", "Ljava.util.ArrayList;", 0x9, NULL, "<T:Ljava/lang/Object;>(Ljava/util/ArrayList<Lim/actor/runtime/generic/mvvm/ChangeDescription<TT;>;>;Ljava/util/ArrayList<TT;>;)Ljava/util/ArrayList<Lim/actor/runtime/generic/mvvm/ChangeDescription<TT;>;>;" },
    { "processAppleModificationsWithJavaUtilArrayList:withJavaUtilArrayList:withBoolean:", "processAppleModifications", "Lim.actor.runtime.generic.mvvm.AppleListUpdate;", 0x9, NULL, "<T:Ljava/lang/Object;>(Ljava/util/ArrayList<Lim/actor/runtime/generic/mvvm/ChangeDescription<TT;>;>;Ljava/util/ArrayList<TT;>;Z)Lim/actor/runtime/generic/mvvm/AppleListUpdate;" },
    { "init", "ChangeBuilder", NULL, 0x2, NULL, NULL },
  };
  static const char *inner_classes[] = {"Lim.actor.runtime.generic.mvvm.alg.ChangeBuilder$State;"};
  static const J2ObjcClassInfo _ARChangeBuilder = { 2, "ChangeBuilder", "im.actor.runtime.generic.mvvm.alg", NULL, 0x11, 4, methods, 0, NULL, 0, NULL, 1, inner_classes, NULL, NULL };
  return &_ARChangeBuilder;
}

@end


#line 14
JavaUtilArrayList *ARChangeBuilder_optimizeWithJavaUtilArrayList_(JavaUtilArrayList *modifications) {
  ARChangeBuilder_initialize();
  
#line 15
  JavaUtilArrayList *res = new_JavaUtilArrayList_init();
  ARChangeDescription *desc = nil;
  for (ARChangeDescription * __strong d in nil_chk(modifications)) {
    
#line 19
    if ([((ARChangeDescription *) nil_chk(d)) getOperationType] == JreLoadStatic(ARChangeDescription_OperationTypeEnum, ADD)) {
      if (desc != nil) {
        if ([desc getOperationType] == JreLoadStatic(ARChangeDescription_OperationTypeEnum, ADD)) {
          if ([desc getIndex] + [desc getLength] == [d getIndex]) {
            desc = ARChangeDescription_mergeAddWithARChangeDescription_withARChangeDescription_(desc, d);
          }
          else {
            
#line 25
            [res addWithId:desc];
            desc = nil;
          }
        }
        else {
          
#line 29
          [res addWithId:desc];
          desc = nil;
        }
      }
    }
    else {
      
#line 34
      if (desc != nil) {
        [res addWithId:desc];
        desc = nil;
      }
    }
    
#line 40
    if (desc == nil) {
      desc = d;
    }
  }
  
#line 45
  if (desc != nil) {
    [res addWithId:desc];
  }
  return res;
}


#line 51
JavaUtilArrayList *ARChangeBuilder_processAndroidModificationsWithJavaUtilArrayList_withJavaUtilArrayList_(JavaUtilArrayList *modifications, JavaUtilArrayList *initialList) {
  ARChangeBuilder_initialize();
  modifications = ARChangeBuilder_optimizeWithJavaUtilArrayList_(modifications);
  
#line 55
  return modifications;
}


#line 58
ARAppleListUpdate *ARChangeBuilder_processAppleModificationsWithJavaUtilArrayList_withJavaUtilArrayList_withBoolean_(JavaUtilArrayList *modifications, JavaUtilArrayList *initialList, jboolean isLoadMore) {
  ARChangeBuilder_initialize();
  
#line 61
  modifications = ARChangeBuilder_optimizeWithJavaUtilArrayList_(modifications);
  
#line 63
  JavaUtilArrayList *states = new_JavaUtilArrayList_init();
  JavaUtilArrayList *current = new_JavaUtilArrayList_init();
  
#line 66
  for (jint i = 0; i < [((JavaUtilArrayList *) nil_chk(initialList)) size]; i++) {
    ARChangeBuilder_State *state = new_ARChangeBuilder_State_init();
    state->startingIndex_ = i;
    [states addWithId:state];
    [current addWithId:state];
  }
  for (ARChangeDescription * __strong m in nil_chk(modifications)) {
    if ([((ARChangeDescription *) nil_chk(m)) getOperationType] == JreLoadStatic(ARChangeDescription_OperationTypeEnum, REMOVE)) {
      for (jint i = 0; i < [m getLength]; i++) {
        ARChangeBuilder_State *state = [current removeWithInt:[m getIndex]];
        ((ARChangeBuilder_State *) nil_chk(state))->wasDeleted_ = true;
      }
    }
    else
#line 78
    if ([m getOperationType] == JreLoadStatic(ARChangeDescription_OperationTypeEnum, ADD)) {
      jint index = [m getIndex];
      for (id __strong itm in nil_chk([m getItems])) {
        ARChangeBuilder_State *state = new_ARChangeBuilder_State_init();
        state->wasAdded_ = true;
        state->item_ = itm;
        [current addWithInt:index++ withId:state];
      }
    }
    else
#line 86
    if ([m getOperationType] == JreLoadStatic(ARChangeDescription_OperationTypeEnum, MOVE)) {
      ARChangeBuilder_State *state = [current removeWithInt:[m getIndex]];
      [current addWithInt:[m getDestIndex] withId:state];
      if (!((ARChangeBuilder_State *) nil_chk(state))->wasAdded_) {
        state->wasMoved_ = true;
      }
    }
    else
#line 92
    if ([m getOperationType] == JreLoadStatic(ARChangeDescription_OperationTypeEnum, UPDATE)) {
      jint index = [m getIndex];
      for (id __strong itm in nil_chk([m getItems])) {
        ARChangeBuilder_State *state = [current getWithInt:index++];
        ((ARChangeBuilder_State *) nil_chk(state))->item_ = itm;
        if (!state->wasAdded_) {
          state->wasUpdated_ = true;
        }
      }
    }
  }
  
#line 104
  JavaUtilArrayList *removed = new_JavaUtilArrayList_init();
  JavaUtilArrayList *moved = new_JavaUtilArrayList_init();
  JavaUtilArrayList *added = new_JavaUtilArrayList_init();
  JavaUtilArrayList *updated = new_JavaUtilArrayList_init();
  
#line 110
  for (jint i = 0; i < [states size]; i++) {
    ARChangeBuilder_State *s = [states getWithInt:i];
    if (((ARChangeBuilder_State *) nil_chk(s))->wasDeleted_) {
      [removed addWithId:JavaLangInteger_valueOfWithInt_(s->startingIndex_)];
    }
  }
  
#line 118
  for (jint i = 0; i < [current size]; i++) {
    ARChangeBuilder_State *s = [current getWithInt:i];
    if (((ARChangeBuilder_State *) nil_chk(s))->wasMoved_ && s->startingIndex_ != i) {
      [moved addWithId:new_ARMove_initWithInt_withInt_(s->startingIndex_, i)];
    }
    if (s->wasUpdated_) {
      [updated addWithId:JavaLangInteger_valueOfWithInt_(i)];
    }
    if (s->wasAdded_) {
      [added addWithId:JavaLangInteger_valueOfWithInt_(i)];
    }
  }
  
#line 131
  return new_ARAppleListUpdate_initWithRemoved_withAdded_withMoved_withUpdated_withLoadMore_(removed, added, moved, updated, isLoadMore);
}


#line 134
void ARChangeBuilder_init(ARChangeBuilder *self) {
  (void) NSObject_init(self);
}


#line 134
ARChangeBuilder *new_ARChangeBuilder_init() {
  ARChangeBuilder *self = [ARChangeBuilder alloc];
  ARChangeBuilder_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ARChangeBuilder)

#line 0 "/Users/ex3ndr/Develop/actor-proprietary/actor-sdk/sdk-core/runtime/runtime-generic/src/main/java//im/actor/runtime/generic/mvvm/alg/ChangeBuilder.java"


#line 138
@implementation ARChangeBuilder_State

J2OBJC_IGNORE_DESIGNATED_BEGIN
- (instancetype)init {
  ARChangeBuilder_State_init(self);
  return self;
}
J2OBJC_IGNORE_DESIGNATED_END

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "init", NULL, NULL, 0x2, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "wasDeleted_", NULL, 0x2, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "startingIndex_", NULL, 0x2, "I", NULL, NULL, .constantValue.asLong = 0 },
    { "wasUpdated_", NULL, 0x2, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "wasMoved_", NULL, 0x2, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "wasAdded_", NULL, 0x2, "Z", NULL, NULL, .constantValue.asLong = 0 },
    { "item_", NULL, 0x2, "TT;", NULL, "TT;", .constantValue.asLong = 0 },
  };
  static const J2ObjcClassInfo _ARChangeBuilder_State = { 2, "State", "im.actor.runtime.generic.mvvm.alg", "ChangeBuilder", 0xa, 1, methods, 6, fields, 0, NULL, 0, NULL, NULL, "<T:Ljava/lang/Object;>Ljava/lang/Object;" };
  return &_ARChangeBuilder_State;
}

@end

void ARChangeBuilder_State_init(ARChangeBuilder_State *self) {
  (void) NSObject_init(self);
  self->startingIndex_ =
#line 140
  -1;
}

ARChangeBuilder_State *new_ARChangeBuilder_State_init() {
  ARChangeBuilder_State *self = [ARChangeBuilder_State alloc];
  ARChangeBuilder_State_init(self);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ARChangeBuilder_State)

#pragma clang diagnostic pop
